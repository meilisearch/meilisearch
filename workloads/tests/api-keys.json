{
  "type": "test",
  "name": "api-keys",
  "binary": {
    "source": "release",
    "edition": "community",
    "version": "1.12.0"
  },
  "commands": [
    {
      "route": "keys",
      "method": "POST",
      "body": {
        "inline": {
          "actions": [
            "search",
            "documents.add"
          ],
          "description": "Test API Key",
          "expiresAt": null,
          "indexes": [
            "movies"
          ],
          "uid": "9e053497-b180-4b9f-bf10-a4a6fc4ca1b2"
        }
      },
      "expectedStatus": 201,
      "expectedResponse": {
        "actions": [
          "search",
          "documents.add"
        ],
        "createdAt": "[timestamp]",
        "description": "Test API Key",
        "expiresAt": null,
        "indexes": [
          "movies"
        ],
        "key": "b387a8dabdc80d4d2069718ca43bad8bcb1ce5d8bb85b31af17a5ea6348317dc",
        "name": null,
        "uid": "9e053497-b180-4b9f-bf10-a4a6fc4ca1b2",
        "updatedAt": "[timestamp]"
      },
      "register": {
        "key": "/key"
      },
      "synchronous": "WaitForResponse"
    },
    {
      "route": "keys/{{ key }}",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "actions": [
          "search",
          "documents.add"
        ],
        "createdAt": "[timestamp]",
        "description": "Test API Key",
        "expiresAt": null,
        "indexes": [
          "movies"
        ],
        "key": "b387a8dabdc80d4d2069718ca43bad8bcb1ce5d8bb85b31af17a5ea6348317dc",
        "name": null,
        "uid": "[uuid]",
        "updatedAt": "[timestamp]"
      },
      "synchronous": "WaitForResponse"
    },
    {
      "route": "/indexes",
      "method": "POST",
      "body": {
        "inline": {
          "primaryKey": "id",
          "uid": "movies"
        }
      },
      "expectedStatus": 202,
      "expectedResponse": {
        "enqueuedAt": "[timestamp]",
        "indexUid": "movies",
        "status": "enqueued",
        "taskUid": 0,
        "type": "indexCreation"
      },
      "synchronous": "WaitForResponse"
    },
    {
      "route": "indexes/movies/documents",
      "method": "POST",
      "body": {
        "inline": {
          "id": 287947,
          "overview": "A boy is given the ability to become an adult superhero in times of need with a single magic word.",
          "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
          "release_date": "2019-03-23",
          "title": "Shazam"
        }
      },
      "expectedStatus": 202,
      "expectedResponse": {
        "enqueuedAt": "[timestamp]",
        "indexUid": "movies",
        "status": "enqueued",
        "taskUid": 1,
        "type": "documentAdditionOrUpdate"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForTask"
    },
    {
      "route": "indexes/movies/search?q=shazam",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "estimatedTotalHits": 1,
        "hits": [
          {
            "id": 287947,
            "overview": "A boy is given the ability to become an adult superhero in times of need with a single magic word.",
            "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
            "release_date": "2019-03-23",
            "title": "Shazam"
          }
        ],
        "limit": 20,
        "offset": 0,
        "processingTimeMs": "[duration]",
        "query": "shazam"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForResponse"
    },
    {
      "binary": {
        "source": "build",
        "edition": "community",
        "extraCliArgs": [
          "--experimental-dumpless-upgrade",
          "--experimental-max-number-of-batched-tasks=0"
        ]
      }
    },
    {
      "route": "indexes/movies/search?q=shazam",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "estimatedTotalHits": 1,
        "hits": [
          {
            "id": 287947,
            "overview": "A boy is given the ability to become an adult superhero in times of need with a single magic word.",
            "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
            "release_date": "2019-03-23",
            "title": "Shazam"
          }
        ],
        "limit": 20,
        "offset": 0,
        "processingTimeMs": "[duration]",
        "query": "shazam",
        "requestUid": "[uid]"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForResponse"
    },
    {
      "binary": {
        "source": "build",
        "edition": "community",
        "extraCliArgs": [
          "--experimental-dumpless-upgrade"
        ]
      }
    },
    {
      "route": "health",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "status": "available"
      },
      "synchronous": "WaitForTask"
    },
    {
      "route": "indexes/movies/search?q=shazam",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "estimatedTotalHits": 1,
        "hits": [
          {
            "id": 287947,
            "overview": "A boy is given the ability to become an adult superhero in times of need with a single magic word.",
            "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
            "release_date": "2019-03-23",
            "title": "Shazam"
          }
        ],
        "limit": 20,
        "offset": 0,
        "processingTimeMs": "[duration]",
        "query": "shazam",
        "requestUid": "[uid]"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForResponse"
    },
    {
      "route": "indexes/movies/documents/287947",
      "method": "DELETE",
      "body": null,
      "expectedStatus": 403,
      "expectedResponse": {
        "code": "invalid_api_key",
        "link": "https://docs.meilisearch.com/errors#invalid_api_key",
        "message": "The provided API key is invalid.",
        "type": "auth"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForResponse"
    },
    {
      "route": "indexes/movies/documents",
      "method": "POST",
      "body": {
        "inline": {
          "id": 287948,
          "overview": "Shazam turns evil and the world is in danger.",
          "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
          "release_date": "2032-03-23",
          "title": "Shazam 2"
        }
      },
      "expectedStatus": 202,
      "expectedResponse": {
        "enqueuedAt": "[timestamp]",
        "indexUid": "movies",
        "status": "enqueued",
        "taskUid": 3,
        "type": "documentAdditionOrUpdate"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForTask"
    },
    {
      "route": "indexes/movies/search?q=shaza",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "estimatedTotalHits": 2,
        "hits": [
          {
            "id": 287947,
            "overview": "A boy is given the ability to become an adult superhero in times of need with a single magic word.",
            "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
            "release_date": "2019-03-23",
            "title": "Shazam"
          },
          {
            "id": 287948,
            "overview": "Shazam turns evil and the world is in danger.",
            "poster": "https://image.tmdb.org/t/p/w1280/xnopI5Xtky18MPhK40cZAGAOVeV.jpg",
            "release_date": "2032-03-23",
            "title": "Shazam 2"
          }
        ],
        "limit": 20,
        "offset": 0,
        "processingTimeMs": "[duration]",
        "query": "shaza",
        "requestUid": "[uid]"
      },
      "apiKeyVariable": "key",
      "synchronous": "WaitForResponse"
    },
    {
      "route": "tasks",
      "method": "GET",
      "body": null,
      "expectedStatus": 200,
      "expectedResponse": {
        "from": 3,
        "limit": 20,
        "next": null,
        "results": [
          {
            "batchUid": 3,
            "canceledBy": null,
            "details": {
              "indexedDocuments": 1,
              "receivedDocuments": 1
            },
            "duration": "[duration]",
            "enqueuedAt": "[timestamp]",
            "error": null,
            "finishedAt": "[timestamp]",
            "indexUid": "movies",
            "startedAt": "[timestamp]",
            "status": "succeeded",
            "type": "documentAdditionOrUpdate",
            "uid": 3
          },
          {
            "batchUid": 2,
            "canceledBy": null,
            "details": {
              "upgradeFrom": "v1.12.0",
              "upgradeTo": "[latest]"
            },
            "duration": "[duration]",
            "enqueuedAt": "[timestamp]",
            "error": null,
            "finishedAt": "[timestamp]",
            "indexUid": null,
            "startedAt": "[timestamp]",
            "status": "succeeded",
            "type": "upgradeDatabase",
            "uid": 2
          },
          {
            "batchUid": 1,
            "canceledBy": null,
            "details": {
              "indexedDocuments": 1,
              "receivedDocuments": 1
            },
            "duration": "[duration]",
            "enqueuedAt": "[timestamp]",
            "error": null,
            "finishedAt": "[timestamp]",
            "indexUid": "movies",
            "startedAt": "[timestamp]",
            "status": "succeeded",
            "type": "documentAdditionOrUpdate",
            "uid": 1
          },
          {
            "batchUid": 0,
            "canceledBy": null,
            "details": {
              "primaryKey": "id"
            },
            "duration": "[duration]",
            "enqueuedAt": "[timestamp]",
            "error": null,
            "finishedAt": "[timestamp]",
            "indexUid": "movies",
            "startedAt": "[timestamp]",
            "status": "succeeded",
            "type": "indexCreation",
            "uid": 0
          }
        ],
        "total": 4
      },
      "synchronous": "WaitForResponse"
    }
  ]
}